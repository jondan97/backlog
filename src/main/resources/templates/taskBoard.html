<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Task Board</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<script type="text/javascript">
    $(document).ready(function () {
        $(document).on('change', 'select', function () {
            var form = $(this).parent();
            $(form).find('#updateAssignee').click();
        });
    });
</script>
<button th:onclick="'window.location.href=\'' + @{/} + '\''"
        type="button">Home
</button>
<span th:if="${todoAssociations}">
  <span th:each="association: ${todoAssociations}">
      <form method="post" name="lmao" th:action="@{/pm/editItem}">
        <span th:text="${association.item.title + ' ' + association.status}">

        </span>
        <select id="itemAssigneeId" name="itemAssigneeId"
                th:disabled="${#authorization.expression('hasAnyAuthority(''PROJECT_MANAGER'',''ADMIN'')') or (session.userId == association.item.assignee.id) ? 'false' : 'true'}">
                    <span th:each="user : ${allUsers}">
                        <option th:selected="${association.item.assignee.id == user.id ? true : false}"
                                th:text="${user.firstName + ' ' + user.lastName + ', ' + user.email}"
                                th:value="${user.id}">
                        </option>
                </span>
        </select>
          <button name="action"
                  th:onclick="'window.location.href=\'' + @{'/user/project/' + ${projectId} + '/item/' + ${association.item.id}} + '\''"
                  type="button" value="view">View
          </button>
      <button name="action"
              th:hidden="${#authorization.expression('hasAnyAuthority(''PROJECT_MANAGER'',''ADMIN'')') or (session.userId == association.item.assignee.id) ? 'false' : 'true'}"
              type="submit"
              value="previous">
            Previous
        </button>
      <button name="action"
              th:hidden="${#authorization.expression('hasAnyAuthority(''PROJECT_MANAGER'',''ADMIN'')') or (session.userId == association.item.assignee.id) ? 'false' : 'true'}"
              type="submit"
              value="next">
            Next
        </button>
          <input hidden id="sprintId" name="sprintId" th:value="${association.sprint.id}">
          <input hidden id="itemId" name="itemId" readonly th:value="${association.item.id}">
          <input hidden id="itemProjectId" name="itemProjectId" readonly th:value="${projectId}">
          <input formaction="/user/updateAssignee" hidden id="updateAssignee" name="updateAssigneeButton"
                 type="submit" value="taskBoardPage">
      </form>
    </span>
</span>
<span th:if="${inProgressAssociations}">
    <span th:each="association: ${inProgressAssociations}">
        <span th:text="${association.item.title + ' ' + association.status}">

        </span>
    </span>
</span>
<span th:if="${forReviewAssociations}">
    <span th:each="association: ${forReviewAssociations}">
        <span th:text="${association.item.title + ' ' + association.status}">

        </span>
    </span>
</span>
<span th:if="${doneAssociations}">
    <span th:each="association: ${doneAssociations}">
        <span th:text="${association.item.title + ' ' + association.status}">

        </span>
    </span>
</span>
</body>
</html>